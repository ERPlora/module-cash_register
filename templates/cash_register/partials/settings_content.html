{% load i18n %}

{% if request.htmx %}
<!-- Tab bar update via OOB swap (only on HTMX navigation) -->
<div id="dashboard-tabbar" hx-swap-oob="innerHTML">
<ion-footer>
{% include "cash_register/partials/tabbar_cash_register.html" with current_view='settings' %}
</ion-footer>
</div>
{% endif %}

<div class="p-4">
    <div class="mb-6">
        <h1 class="text-3xl font-bold" style="color: var(--ion-text-color);">{% trans "Configuración de Caja" %}</h1>
        <p class="text-sm mt-2" style="color: var(--ion-color-medium);">{% trans "Ajustes del módulo de caja registradora" %}</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Global Config (Read-only) -->
        <ion-card class="m-0">
            <ion-card-header>
                <ion-card-title>{% trans "Configuración del Hub" %}</ion-card-title>
                <ion-card-subtitle>{% trans "Solo lectura - se gestiona desde ajustes generales" %}</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-list>
                    <ion-item>
                        <ion-icon name="cash-outline" slot="start" style="color: var(--ion-color-primary);"></ion-icon>
                        <ion-label>
                            <h3>{% trans "Moneda" %}</h3>
                            <p>{{ HUB_CONFIG.currency }}</p>
                        </ion-label>
                    </ion-item>
                    <ion-item>
                        <ion-icon name="business-outline" slot="start" style="color: var(--ion-color-primary);"></ion-icon>
                        <ion-label>
                            <h3>{% trans "Nombre del Negocio" %}</h3>
                            <p>{{ STORE_CONFIG.business_name|default:"No configurado" }}</p>
                        </ion-label>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>

        <!-- Plugin Config (Editable) -->
        <ion-card class="m-0">
            <ion-card-header>
                <ion-card-title>{% trans "Configuración del Módulo" %}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
                <form id="settings-form"
                      hx-post="{% url 'cash_register:settings' %}"
                      hx-target="#save-status"
                      hx-swap="innerHTML"
                      hx-trigger="change delay:500ms">
                    {% csrf_token %}

                    <ion-list>
                        <ion-item>
                            <ion-label>
                                <h3>{% trans "Activar Caja" %}</h3>
                                <p>{% trans "Activar/desactivar funcionalidad de caja" %}</p>
                            </ion-label>
                            <ion-toggle
                                slot="end"
                                name="enable_cash_register"
                                {% if config.enable_cash_register %}checked{% endif %}>
                            </ion-toggle>
                        </ion-item>

                        <ion-item>
                            <ion-label>
                                <h3>{% trans "Requerir Saldo Inicial" %}</h3>
                                <p>{% trans "Requerir conteo al abrir sesión" %}</p>
                            </ion-label>
                            <ion-toggle
                                slot="end"
                                name="require_opening_balance"
                                {% if config.require_opening_balance %}checked{% endif %}>
                            </ion-toggle>
                        </ion-item>

                        <ion-item>
                            <ion-label>
                                <h3>{% trans "Requerir Saldo Final" %}</h3>
                                <p>{% trans "Requerir conteo al cerrar sesión" %}</p>
                            </ion-label>
                            <ion-toggle
                                slot="end"
                                name="require_closing_balance"
                                {% if config.require_closing_balance %}checked{% endif %}>
                            </ion-toggle>
                        </ion-item>

                        <ion-item>
                            <ion-label>
                                <h3>{% trans "Permitir Saldo Negativo" %}</h3>
                                <p>{% trans "Permitir balance negativo en caja" %}</p>
                            </ion-label>
                            <ion-toggle
                                slot="end"
                                name="allow_negative_movements"
                                {% if config.allow_negative_movements %}checked{% endif %}>
                            </ion-toggle>
                        </ion-item>
                    </ion-list>

                    <!-- Protected URL -->
                    <div class="mt-4 p-4 rounded-lg" style="background: var(--ion-color-light);">
                        <ion-label>
                            <h3 class="font-medium" style="color: var(--ion-text-color);">{% trans "URL Protegida del POS" %}</h3>
                            <p class="text-xs mt-1" style="color: var(--ion-color-medium);">{% trans "URL que requiere sesión de caja abierta" %}</p>
                        </ion-label>

                        <div class="flex gap-2 items-center mt-3">
                            <ion-input
                                type="text"
                                name="protected_pos_url"
                                value="{{ config.protected_pos_url|default:'/modules/sales/pos/' }}"
                                placeholder="/modules/sales/pos/"
                                fill="outline"
                                style="flex: 1;">
                            </ion-input>

                            <ion-button type="submit" fill="clear" color="primary">
                                <ion-icon slot="icon-only" name="save-outline"></ion-icon>
                            </ion-button>
                        </div>
                    </div>

                    <!-- Save Status -->
                    <div id="save-status" class="text-center mt-4"></div>
                </form>
            </ion-card-content>
        </ion-card>
    </div>
</div>
