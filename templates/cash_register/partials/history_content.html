{% load i18n ui component_tags %}

{% component "page"
    title=_("Session History")
    module_id="cash_register"
    tabbar_view="history" %}

    {% fill "content" %}
        <!-- Filters -->
    {% ui_card css_class="mb-md" %}
        <ion-segment value="{{ status_filter|default:'all' }}" style="max-width: 300px;">
            <ion-segment-button value="all"
                hx-get="{% url 'cash_register:history' %}"
                hx-target="#main-content-area"
                hx-push-url="true">
                <ion-label>{% trans "All" %}</ion-label>
            </ion-segment-button>
            <ion-segment-button value="open"
                hx-get="{% url 'cash_register:history' %}?status=open"
                hx-target="#main-content-area"
                hx-push-url="true">
                <ion-label>{% trans "Open" %}</ion-label>
            </ion-segment-button>
            <ion-segment-button value="closed"
                hx-get="{% url 'cash_register:history' %}?status=closed"
                hx-target="#main-content-area"
                hx-push-url="true">
                <ion-label>{% trans "Closed" %}</ion-label>
            </ion-segment-button>
        </ion-segment>
    {% endui_card %}

    <!-- Sessions Table -->
    {% ui_card css_class="m-0" %}
        {% if sessions %}
        <div class="data-table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>{% trans "Session" %}</th>
                        <th class="cell-center">{% trans "Status" %}</th>
                        <th class="cell-center">{% trans "Opened" %}</th>
                        <th class="cell-center">{% trans "Closed" %}</th>
                        <th class="cell-right">{% trans "Opening Balance" %}</th>
                        <th class="cell-right">{% trans "Closing Balance" %}</th>
                        <th class="cell-right">{% trans "Difference" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions %}
                    <tr>
                        <td>
                            <a hx-get="{% url 'cash_register:session_detail' session.id %}"
                               hx-target="#main-content-area"
                               hx-push-url="true"
                               class="text-primary cursor-pointer fw-medium">
                                {{ session.session_number }}
                            </a>
                        </td>
                        <td class="cell-center">
                            {% if session.status == 'open' %}
                            <ion-badge color="success">{% trans "Open" %}</ion-badge>
                            {% else %}
                            <ion-badge color="medium">{% trans "Closed" %}</ion-badge>
                            {% endif %}
                        </td>
                        <td class="cell-center">{{ session.opened_at|date:"d/m/Y H:i" }}</td>
                        <td class="cell-center">{{ session.closed_at|date:"d/m/Y H:i"|default:"—" }}</td>
                        <td class="cell-right">{{ session.opening_balance|floatformat:2 }} €</td>
                        <td class="cell-right fw-semibold">
                            {% if session.closing_balance %}
                            {{ session.closing_balance|floatformat:2 }} €
                            {% else %}
                            {{ session.get_current_balance|floatformat:2 }} €
                            {% endif %}
                        </td>
                        <td class="cell-right fw-semibold {% if session.get_difference >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {% if session.status == 'closed' %}
                            {% if session.get_difference > 0 %}+{% endif %}{{ session.get_difference|floatformat:2 }} €
                            {% else %}
                            —
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        {% ui_empty_state title=_("No sessions recorded") description=_("Open your first session to get started") icon="time-outline" action_label=_("Open First Session") action_url="/modules/cash-register/open/" %}
        {% endif %}
    {% endui_card %}
    {% endfill %}
{% endcomponent %}
